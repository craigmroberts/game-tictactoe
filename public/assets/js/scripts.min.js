String.prototype.replaceAll=function(e,a){var t;return this.replace(new RegExp(e,"g"),a)};var Validate={form:function(e){var a=$(e+" input:not([type=submit])").length,t=[];Validate.clearForm();for(var o=0;o<a;o++){var T=$(e+" input:not([type=submit])").eq(o),c;Validate.input(T)&&(t[T.attr("name")]=Validate.input(T))}return!(0<Object.keys(t).length)},clearForm:function(){$(".validate-form--error").removeClass("validate-form--error"),$(".validate-form--valid").removeClass("validate-form--valid"),$(".validate-form__message").remove()},clearInput:function(e){e.removeClass("validate-form--error"),e.removeClass("validate-form--valid"),e.next(".validate-form__message").remove()},input:function(e){var a=e.val(),t=e.attr("name"),o=e.attr("type"),T=!1,c,i;(Validate.clearInput(e),"email"===o)&&(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(a).toLowerCase())||(T="Enter a valid email address"));return"password"===o&&(a.length<6?T="The password is too short":/[0-9]/.test(a)?/[a-z]/.test(a)?/[A-Z]/.test(a)||(T="Password must contain an uppercase letter"):T="Password must contain a lowercase letter":T="Password must contain a number"),e.attr("required")&&a.length<=0&&(T="Enter your "+t),T?(e.addClass("validate-form--error"),e.after('<span class="validate-form__message">'+T+"</span>")):e.addClass("validate-form--valid"),T}};$(document).on("keyup",".validate-form input",function(e){Validate.input($(this))}),$(document).on("click",".validate-check",function(e){var a,t=".validate-form:eq("+$(".validate-form").index($(this).parents(".validate-form"))+")";Validate.form(t)});var App={data:!1,url:{root:"https://work.craigmroberts.com/tictactoe/",api:"https://work.craigmroberts.com/tictactoe/api/"},prepareData:function(){for(var e=$("#"+View.currentView+' form input:not([type="submit"])'),a={},t=0;t<e.length;t++)a[e.eq(t).attr("name")]=e.eq(t).val();App.data=a},updateContent:function(){if(App.data)for(var e=TicTacToe.stats.getAll(),a=0;a<$("[data-dynamic]").length;a++){var t=$("[data-dynamic]").eq(a),o=t.data("dynamic");void 0!==e[o]?t.html(e[o]):t.html(App.data[o])}}},TicTacToe={board:".board",computerPlaySpeed:200,currentMove:!1,playersPiece:"x",computersPiece:"o"===this.playersPiece?"x":"o",square:".board__square",status:!1,boardToString:[0,0,0,0,0,0,0,0,0],score:{update:function(){"?"!==TicTacToe.status&&App.updateContent()}},takeTurn:function(e){TicTacToe.status||(TicTacToe.Timer.start(),TicTacToe.status="?");var a=TicTacToe.check.bestMove(),t=TicTacToe.computersPiece;"player"===TicTacToe.currentMove?(a=e.index(),t=TicTacToe.playersPiece,TicTacToe.currentMove="computer"):"computer"===TicTacToe.currentMove&&(TicTacToe.currentMove="player"),$(TicTacToe.square).eq(a).addClass("board__square--taken board__square__"+t),TicTacToe.boardToString[a]=t,TicTacToe.check.win(),TicTacToe.check.tie(),"?"!==TicTacToe.status&&TicTacToe.Timer.end(),TicTacToe.sound.play(),"?"===TicTacToe.status&&"computer"===TicTacToe.currentMove&&setTimeout(function(){TicTacToe.takeTurn()},TicTacToe.computerPlaySpeed),"?"!==TicTacToe.status&&(TicTacToe.stats.updateAll(),TicTacToe.score.update(),TicTacToe.Player.updateStats(function(e){}),TicTacToe.reset())},check:{tie:function(){if("?"===TicTacToe.status){for(var e=0;e<TicTacToe.boardToString.length;e++)if(0===TicTacToe.boardToString[e])return!1;return TicTacToe.status="t",$(TicTacToe.board).addClass("board--blink-borders"),!0}},win:function(){var e=TicTacToe.check.winningRow(0,1,2)||TicTacToe.check.winningRow(3,4,5)||TicTacToe.check.winningRow(6,7,8)||TicTacToe.check.winningRow(0,3,6)||TicTacToe.check.winningRow(1,4,7)||TicTacToe.check.winningRow(2,5,8)||TicTacToe.check.winningRow(0,4,8)||TicTacToe.check.winningRow(6,4,2);if(e){TicTacToe.status=e.gamePiece,$(TicTacToe.board).addClass("board--blink-winner");for(var a=0;a<3;a++)$(TicTacToe.square).eq(e.cells[a]).addClass("board__square--win")}},winningRow:function(e,a,t){return TicTacToe.boardToString[e]===TicTacToe.boardToString[a]&&TicTacToe.boardToString[a]===TicTacToe.boardToString[t]&&0!==TicTacToe.boardToString[e]&&{cells:[e,a,t],gamePiece:TicTacToe.boardToString[e]}},bestMove:function(){var e=TicTacToe.check.findBestMove(TicTacToe.computersPiece),a,t=TicTacToe.check.findBestMove(TicTacToe.playersPiece);return(e||0===e)&&(t=e),t||0===t||(t=(t=TicTacToe.getAvailableSquares())[Math.floor(Math.random()*t.length)]),t},findBestMove:function(e){var a=TicTacToe.check.getBestMove(0,1,2,e);return a=(a=(a=(a=(a=(a=(a=a||0===a?a:TicTacToe.check.getBestMove(3,4,5,e))||0===a?a:TicTacToe.check.getBestMove(6,7,8,e))||0===a?a:TicTacToe.check.getBestMove(0,3,6,e))||0===a?a:TicTacToe.check.getBestMove(1,4,7,e))||0===a?a:TicTacToe.check.getBestMove(2,5,8,e))||0===a?a:TicTacToe.check.getBestMove(0,4,8,e))||0===a?a:TicTacToe.check.getBestMove(6,4,2,e)},getBestMove:function(e,a,t,o){return 0===TicTacToe.boardToString[e]&&TicTacToe.boardToString[a]===TicTacToe.boardToString[t]&&TicTacToe.boardToString[a]===o?e:0===TicTacToe.boardToString[a]&&TicTacToe.boardToString[e]===TicTacToe.boardToString[t]&&TicTacToe.boardToString[e]===o?a:0===TicTacToe.boardToString[t]&&TicTacToe.boardToString[e]===TicTacToe.boardToString[a]&&TicTacToe.boardToString[e]===o&&t}},reset:function(){TicTacToe.boardToString=[0,0,0,0,0,0,0,0,0],setTimeout(function(){$(".board").removeClass("board--blink-winner board--blink-borders"),$(".board__square").removeClass("board__square--taken board__square--win board__square__o board__square__x"),TicTacToe.status=!1},1e3)},getAvailableSquares:function(){for(var e=new Array,a=0;a<TicTacToe.boardToString.length;a++)TicTacToe.boardToString[a]||e.push(a);return e}};TicTacToe.Timer={startTime:0,endTime:0,bestTime:!1,timeDiff:0,start:function(){TicTacToe.Timer.startTime=new Date},end:function(){return TicTacToe.Timer.endTime=new Date,TicTacToe.Timer.timeDiff=TicTacToe.Timer.endTime-TicTacToe.Timer.startTime,TicTacToe.Timer.timeDiff/=1e3,TicTacToe.status===TicTacToe.playersPiece&&(TicTacToe.Timer.timeDiff<TicTacToe.Timer.bestTime||!TicTacToe.Timer.bestTime)&&(TicTacToe.Timer.timeDiff<App.data.bestScore||0==App.data.bestScore)&&(TicTacToe.Timer.bestTime=TicTacToe.Timer.timeDiff),TicTacToe.Timer.timeDiff}};var View={currentView:!(TicTacToe.sound={isMuted:!1,gameover:document.getElementById("aud-gameover"),gameoverTie:document.getElementById("aud-gameover-tie"),noteHigh:document.getElementById("aud-note-high"),noteLow:document.getElementById("aud-note-low"),play:function(){TicTacToe.sound.isMuted||("t"===TicTacToe.status?TicTacToe.sound.gameoverTie.play():"x"===TicTacToe.status||"o"===TicTacToe.status?TicTacToe.sound.gameover.play():"?"===TicTacToe.status&&("computer"===TicTacToe.currentMove?TicTacToe.sound.noteHigh.play():TicTacToe.sound.noteLow.play()))}}),switch:function(e){Validate.clearForm(),View.currentView=e,$("body").addClass(e),$(".page--active").removeClass("page--active"),$("#"+e).addClass("page--active")}};TicTacToe.User={getByUserID:function(e,a){if(a){var t=App.url.api+"user/getUser";App.prepareData();var o={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"getUser",data:btoa(JSON.stringify({id:e}))};jQuery.ajax({url:t,type:"post",data:o}).always(function(e){return(e=JSON.parse(atob(e))).result?(App.data=e.data,localStorage.setItem("sessionID",App.data.id,{expires:30}),TicTacToe.stats.update(App.data),App.updateContent(),$("body").addClass("activeUser"),View.switch("tictactoe"),TicTacToe.stats.updateAll(),0<App.data.bestScore&&$(".best-time").removeClass("hidden")):alert(e.message),a(e)})}},login:function(a){if(a){var e=App.url.api+"user/login";App.prepareData();var t={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"login",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:t}).always(function(e){return(e=JSON.parse(atob(e))).result?(App.data=e.data,localStorage.setItem("sessionID",App.data.id,{expires:30}),TicTacToe.stats.update(App.data),App.updateContent(),$("body").addClass("activeUser"),View.switch("tictactoe"),TicTacToe.stats.updateAll(),0<App.data.bestScore&&$(".best-time").removeClass("hidden")):alert(e.message),a(e)})}},signup:function(a){if(a){var e=App.url.api+"user/signup";App.prepareData();var t={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"signup",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:t}).always(function(e){return(e=JSON.parse(atob(e)))&&(App.data=e.data,localStorage.setItem("sessionID",App.data.id,{expires:30}),App.updateContent(),$("body").addClass("activeUser"),View.switch("tictactoe")),a(e)})}},delete:function(a){if(a){var e=App.url.api+"user/delete",t={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"delete",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:t}).always(function(e){return(e=JSON.parse(atob(e)))&&View.switch("tictactoe"),a(e)})}},signOut:function(){$("body").removeClass("activeUser"),App.data=!1,localStorage.removeItem("sessionID"),window.location.href="/"}},TicTacToe.Player={updateStats:function(a){if(a){var e=App.url.api+"user/update-score",t=TicTacToe.stats.getAll();t.id=App.data.id;var o={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"updateStats",data:btoa(JSON.stringify(t))};jQuery.ajax({url:e,type:"post",data:o}).always(function(e){return(e=JSON.parse(atob(e)))&&View.switch("tictactoe"),a(e)})}}},$(document).on("click",'a[href^="#/"]',function(e){location.hash=$(this).attr("href");var a=location.hash.split("#")[1].replaceAll("/","");a=""===a?"home":a,View.switch(a)}),$(document).on("click","[data-action]",function(e){var a;switch(e.preventDefault(),$(this).data("action")){case"signup":Validate.form("#form-signup")&&TicTacToe.User.signup(function(e){});break;case"login":Validate.form("#form-login")&&TicTacToe.User.login(function(e){});break;case"signout":TicTacToe.User.signOut(function(e){});break;case"delete":TicTacToe.User.delete(function(e){TicTacToe.User.signOut(function(e){})})}}),$(document).on("click",TicTacToe.square,function(){$(this).hasClass("board__square--taken")||(TicTacToe.currentMove="player",TicTacToe.takeTurn($(this)))}),$(document).on("click",".btn__sound",function(){$(this).hasClass("btn__sound--mute")?TicTacToe.sound.isMuted=!1:TicTacToe.sound.isMuted=!0,$(this).toggleClass("btn__sound--mute")}),$(document).on("click",".btn__language",function(){$("#language-menu").toggleClass("hidden")}),TicTacToe.stats={totalGamesPlayed:0,totalWon:0,totalTies:0,totalLost:0,totalGameTime:0,averageWin:0,averageGameTime:0,bestStreak:0,currentStreak:0,bestScore:0,updateAll:function(){"?"!=TicTacToe.status&&("x"===TicTacToe.status?(TicTacToe.stats.totalWon++,TicTacToe.Timer.bestTime&&(TicTacToe.stats.bestScore=TicTacToe.Timer.bestTime),TicTacToe.stats.currentStreak++):"o"===TicTacToe.status?(TicTacToe.stats.totalLost++,TicTacToe.stats.currentStreak=0):"t"===TicTacToe.status&&(TicTacToe.stats.totalTies++,TicTacToe.stats.currentStreak=0),TicTacToe.stats.currentStreak>TicTacToe.stats.bestStreak&&(TicTacToe.stats.bestStreak=TicTacToe.stats.currentStreak),TicTacToe.stats.totalGameTime=parseFloat(TicTacToe.Timer.timeDiff)+parseFloat(TicTacToe.stats.totalGameTime),TicTacToe.stats.totalGamesPlayed=parseInt(TicTacToe.stats.totalWon)+parseInt(TicTacToe.stats.totalTies)+parseInt(TicTacToe.stats.totalLost),TicTacToe.stats.averageWin=TicTacToe.stats.totalWon/TicTacToe.stats.totalGamesPlayed*100,TicTacToe.stats.averageGameTime=(parseFloat(TicTacToe.stats.averageGameTime)+parseFloat(TicTacToe.Timer.timeDiff))/2)},getNiceTime:function(e){e=Number(e);var a=Math.floor(e/86400),t=Math.floor(e%86400/3600),o=Math.floor(e%3600/60),T=Math.floor(e%3600%60),c,i,r,s;return(0<a?a+(1==a?" day, ":" days, "):"")+(0<t?t+(1==t?" hr, ":" hrs, "):"")+(0<o?o+(1==o?" min, ":" mins, "):"")+(0<T?T+" s":"")},update:function(e){TicTacToe.stats.totalGamesPlayed=e.totalGamesPlayed,TicTacToe.stats.totalWon=e.totalWon,TicTacToe.stats.totalTies=e.totalTies,TicTacToe.stats.totalLost=e.totalLost,TicTacToe.stats.totalGameTime=e.totalGameTime,TicTacToe.stats.averageWin=e.averageWin,TicTacToe.stats.averageGameTime=e.averageGameTime,TicTacToe.stats.bestStreak=e.bestStreak,TicTacToe.stats.bestScore=e.bestScore,TicTacToe.stats.currentStrea=e.currentStreak,TicTacToe.stats.totalGameTimeNice=TicTacToe.stats.getNiceTime(e.totalGameTime),TicTacToe.stats.averageWinNice=parseFloat(e.averageWin).toFixed(2)+"%",TicTacToe.stats.averageGameTimeNice=TicTacToe.stats.getNiceTime(e.averageGameTime)},getAll:function(){return{totalGamesPlayed:TicTacToe.stats.totalGamesPlayed,totalWon:TicTacToe.stats.totalWon,totalTies:TicTacToe.stats.totalTies,totalLost:TicTacToe.stats.totalLost,totalGameTime:TicTacToe.stats.totalGameTime,averageWin:TicTacToe.stats.averageWin,averageGameTime:TicTacToe.stats.averageGameTime,bestStreak:TicTacToe.stats.bestStreak,bestScore:TicTacToe.stats.bestScore,currentStreak:TicTacToe.stats.currentStreak,totalGameTimeNice:TicTacToe.stats.getNiceTime(TicTacToe.stats.totalGameTime),averageWinNice:parseFloat(TicTacToe.stats.averageWin).toFixed(2)+"%",averageGameTimeNice:TicTacToe.stats.getNiceTime(TicTacToe.stats.averageGameTime)}}};var sessionID=localStorage.getItem("sessionID");sessionID?TicTacToe.User.getByUserID(sessionID,function(e){console.log(sessionID)}):(console.log("no session"),View.switch("home"));
