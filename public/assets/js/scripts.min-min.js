var App={data:(String.prototype.replaceAll=function(e,a){var c;return this.replace(new RegExp(e,"g"),a)},!1),url:{root:"https://tictactoe.craigmroberts.com/",api:"/api/"},prepareData:function(){for(var e=$("#"+View.currentView+' form input:not([type="submit"])'),a={},c=0;c<e.length;c++)a[e.eq(c).attr("name")]=e.eq(c).val();App.data=a},updateContent:function(){if(App.data)for(var e=0;e<$("[data-dynamic]").length;e++){var a=$("[data-dynamic]").eq(e).data("dynamic");$("[data-dynamic]").eq(e).html(App.data[a])}}},TicTacToe={board:".board",computerPlaySpeed:200,currentMove:!1,playersPiece:"x",computersPiece:"o"===this.playersPiece?"x":"o",square:".board .square",status:!1,boardToString:[0,0,0,0,0,0,0,0,0],score:{computer:0,player:0,tie:0,update:function(){"?"!==TicTacToe.status&&("t"===TicTacToe.status?TicTacToe.score.tie++:TicTacToe.status===TicTacToe.playersPiece?TicTacToe.score.player++:TicTacToe.status===TicTacToe.computersPiece&&TicTacToe.score.computer++,$(".board-stats .tie .score").html(TicTacToe.score.tie),$(".board-stats .player .score").html(TicTacToe.score.player),$(".board-stats .computer .score").html(TicTacToe.score.computer),TicTacToe.Timer.bestTime&&$(".board-stats .best-time .score").html(TicTacToe.Timer.bestTime))}},takeTurn:function(e){TicTacToe.status||(TicTacToe.Timer.start(),TicTacToe.status="?");var a=TicTacToe.check.bestMove(),c=TicTacToe.computersPiece;"player"===TicTacToe.currentMove?(a=e.index(),c=TicTacToe.playersPiece,TicTacToe.currentMove="computer"):"computer"===TicTacToe.currentMove&&(TicTacToe.currentMove="player"),$(TicTacToe.square).eq(a).addClass(c),TicTacToe.boardToString[a]=c,TicTacToe.check.win(),TicTacToe.check.tie(),TicTacToe.score.update(),TicTacToe.sound.play(),"?"===TicTacToe.status&&"computer"===TicTacToe.currentMove&&setTimeout(function(){TicTacToe.takeTurn()},TicTacToe.computerPlaySpeed),TicTacToe.reset()},check:{tie:function(){if("?"===TicTacToe.status){for(var e=0;e<TicTacToe.boardToString.length;e++)if(0===TicTacToe.boardToString[e])return!1;return TicTacToe.status="t",$(TicTacToe.board).addClass("blink"),!0}},win:function(){var e=TicTacToe.check.winningRow(0,1,2)||TicTacToe.check.winningRow(3,4,5)||TicTacToe.check.winningRow(6,7,8)||TicTacToe.check.winningRow(0,3,6)||TicTacToe.check.winningRow(1,4,7)||TicTacToe.check.winningRow(2,5,8)||TicTacToe.check.winningRow(0,4,8)||TicTacToe.check.winningRow(6,4,2);if(e){e.gamePiece===TicTacToe.playersPiece&&TicTacToe.Timer.end(),TicTacToe.status=e.gamePiece;for(var a=0;a<3;a++)$(TicTacToe.square).eq(e.cells[a]).addClass("blink")}},winningRow:function(e,a,c){return TicTacToe.boardToString[e]===TicTacToe.boardToString[a]&&TicTacToe.boardToString[a]===TicTacToe.boardToString[c]&&0!==TicTacToe.boardToString[e]&&{cells:[e,a,c],gamePiece:TicTacToe.boardToString[e]}},bestMove:function(){var e=TicTacToe.check.findBestMove(TicTacToe.computersPiece),a,c=TicTacToe.check.findBestMove(TicTacToe.playersPiece);return(e||0===e)&&(c=e),c||0===c||(c=(c=TicTacToe.getAvailableSquares())[Math.floor(Math.random()*c.length)]),c},findBestMove:function(e){var a=TicTacToe.check.getBestMove(0,1,2,e);return(a=(a=(a=(a=(a=(a=a||0===a?a:TicTacToe.check.getBestMove(3,4,5,e))||0===a?a:TicTacToe.check.getBestMove(6,7,8,e))||0===a?a:TicTacToe.check.getBestMove(0,3,6,e))||0===a?a:TicTacToe.check.getBestMove(1,4,7,e))||0===a?a:TicTacToe.check.getBestMove(2,5,8,e))||0===a?a:TicTacToe.check.getBestMove(0,4,8,e))||0===a?a:TicTacToe.check.getBestMove(6,4,2,e)},getBestMove:function(e,a,c,T){return 0===TicTacToe.boardToString[e]&&TicTacToe.boardToString[a]===TicTacToe.boardToString[c]&&TicTacToe.boardToString[a]===T?e:0===TicTacToe.boardToString[a]&&TicTacToe.boardToString[e]===TicTacToe.boardToString[c]&&TicTacToe.boardToString[e]===T?a:0===TicTacToe.boardToString[c]&&TicTacToe.boardToString[e]===TicTacToe.boardToString[a]&&TicTacToe.boardToString[e]===T&&c}},reset:function(){"?"!==TicTacToe.status&&(TicTacToe.boardToString=[0,0,0,0,0,0,0,0,0],setTimeout(function(){$(".o").removeClass("o"),$(".x").removeClass("x"),$(".blink").removeClass("blink"),TicTacToe.status=!1},1e3))},getAvailableSquares:function(){for(var e=new Array,a=0;a<TicTacToe.boardToString.length;a++)TicTacToe.boardToString[a]||e.push(a);return e}};TicTacToe.Timer={startTime:0,endTime:0,bestTime:!1,timeDiff:0,start:function(){TicTacToe.Timer.startTime=new Date},end:function(){return TicTacToe.Timer.endTime=new Date,TicTacToe.Timer.timeDiff=TicTacToe.Timer.endTime-TicTacToe.Timer.startTime,TicTacToe.Timer.timeDiff/=1e3,(TicTacToe.Timer.timeDiff<TicTacToe.Timer.bestTime||!TicTacToe.Timer.bestTime)&&(TicTacToe.Timer.timeDiff<App.data.bestScore||0==App.data.bestScore)&&(TicTacToe.Timer.bestTime=TicTacToe.Timer.timeDiff,$(".board-stats .best-time.hidden").removeClass("hidden"),$(".board-stats .best-time").addClass("blink"),TicTacToe.Player.updateBestScore(function(e){})),TicTacToe.Timer.timeDiff}};var View={currentView:(TicTacToe.sound={isMuted:!1,gameover:document.getElementById("aud-gameover"),gameoverTie:document.getElementById("aud-gameover-tie"),noteHigh:document.getElementById("aud-note-high"),noteLow:document.getElementById("aud-note-low"),play:function(){TicTacToe.sound.isMuted||("t"===TicTacToe.status?TicTacToe.sound.gameoverTie.play():"x"===TicTacToe.status||"o"===TicTacToe.status?TicTacToe.sound.gameover.play():"?"===TicTacToe.status&&("computer"===TicTacToe.currentMove?TicTacToe.sound.noteHigh.play():TicTacToe.sound.noteLow.play()))}},!1),switch:function(e){View.currentView=e,$("body").addClass(e),$(".page.active").removeClass("active"),$("#"+e).addClass("active")}};TicTacToe.Person={login:function(a){if(a){var e=App.url.api+"user/login";App.prepareData();var c={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"login",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:c}).always(function(e){return(e=JSON.parse(atob(e))).result?(App.data=e.data,App.updateContent(),$("body").addClass("activeUser"),View.switch("tictactoe"),0<App.data.bestScore&&$(".best-time").removeClass("hidden")):alert(e.message),a(e)})}},signup:function(a){if(a){var e=App.url.api+"user/signup";App.prepareData();var c={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"signup",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:c}).always(function(e){return(e=JSON.parse(atob(e)))&&(App.data=e,App.updateContent(),$("body").addClass("activeUser"),View.switch("tictactoe")),a(e)})}},delete:function(a){if(a){var e=App.url.api+"user/delete",c={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"delete",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:c}).always(function(e){return(e=JSON.parse(atob(e)))&&View.switch("tictactoe"),a(e)})}},signOut:function(){$("body").removeClass("activeUser"),App.data=!1,window.location.href="/"}},TicTacToe.Player={updateBestScore:function(a){if(a){var e=App.url.api+"user/update-score";App.data.bestScore=TicTacToe.Timer.bestTime;var c={currentDate:(new Date).toLocaleString().replaceAll("/","-").replaceAll(",",""),action:"updateBestScore",data:btoa(JSON.stringify(App.data))};jQuery.ajax({url:e,type:"post",data:c}).always(function(e){return(e=JSON.parse(atob(e)))&&View.switch("tictactoe"),a(e)})}}},$(document).on("click",'a[href^="#/"]',function(e){location.hash=$(this).attr("href");var a=location.hash.split("#")[1].replaceAll("/","");a=""===a?"home":a,View.switch(a)}),$(document).on("click","[data-action]",function(e){var a;switch(e.preventDefault(),$(this).data("action")){case"signup":TicTacToe.Person.signup(function(e){});break;case"login":TicTacToe.Person.login(function(e){});break;case"signout":TicTacToe.Person.signOut(function(e){});break;case"delete":TicTacToe.Person.delete(function(e){TicTacToe.Person.signOut(function(e){})})}}),$(document).on("click",TicTacToe.square,function(){$(this).hasClass("o")||$(this).hasClass("x")||(TicTacToe.currentMove="player",TicTacToe.takeTurn($(this)))}),$(document).on("click",".btn-sound",function(){$(this).hasClass("mute")?TicTacToe.sound.isMuted=!1:TicTacToe.sound.isMuted=!0,$(this).toggleClass("mute")}),$(document).on("click",".btn-language",function(){$("#language-menu").toggleClass("hidden")});